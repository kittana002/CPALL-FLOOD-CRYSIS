<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flood Impact CP-ALL Monitoring Dashboard</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#0d9488',
                        'primary-dark': '#0f766e',
                        'background': '#f1f5f9',
                        'surface': '#ffffff',
                        'on-surface': '#1e293b',
                        'on-surface-muted': '#64748b',
                    }
                }
            }
        }
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        #map { height: 600px; width: 100%; border-radius: 0.5rem; z-index: 1; }
        .leaflet-tooltip { font-family: 'Sarabun', sans-serif; font-weight: 600; }
        /* Fix for map markers overlap */
        .leaflet-div-icon { background: transparent !important; border: none !important; }
    </style>
</head>
<body class="bg-background text-on-surface">

    <div class="container mx-auto p-4 md:p-6">
        
        <header class="mb-8 flex flex-col md:flex-row justify-between items-center bg-white p-4 rounded-lg shadow-sm">
            <div class="flex items-center mb-4 md:mb-0">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/40/7-eleven_logo.svg/244px-7-eleven_logo.svg.png" alt="7-Eleven Logo" class="h-10 mr-4">
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold text-on-surface">Flood Impact Monitor</h1>
                    <p class="text-sm text-on-surface-muted">Dashboard ติดตามสถานะร้านสาขาภาคใต้</p>
                </div>
            </div>
            
            <div class="flex flex-col items-end">
                <div id="clock" class="text-right text-lg font-bold text-primary mb-2"></div>
                <div class="flex items-center space-x-2 w-full md:w-auto">
                    <input type="text" id="searchInput" placeholder="ค้นหา สาขา/จังหวัด..." class="w-full md:w-64 px-4 py-2 bg-slate-50 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary text-sm">
                    <button id="resetButton" class="px-4 py-2 bg-slate-600 text-white font-semibold rounded-lg hover:bg-slate-700 transition duration-300 text-sm whitespace-nowrap">รีเซ็ตทั้งหมด</button>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div id="card-total" class="bg-surface p-4 rounded-lg shadow-sm border-b-4 border-primary cursor-pointer hover:shadow-md transition">
                <p class="text-xs font-bold text-on-surface-muted uppercase tracking-wider">สาขาทั้งหมด</p>
                <p id="kpi-total-stores" class="text-3xl font-bold text-on-surface mt-1">0</p>
            </div>
            <div id="card-provinces" class="bg-surface p-4 rounded-lg shadow-sm border-b-4 border-sky-500 cursor-pointer hover:shadow-md transition">
                <p class="text-xs font-bold text-on-surface-muted uppercase tracking-wider">จังหวัดที่กระทบ</p>
                <p id="kpi-affected-provinces" class="text-3xl font-bold text-on-surface mt-1">0</p>
            </div>
            <div id="card-high-risk" class="bg-surface p-4 rounded-lg shadow-sm border-b-4 border-amber-500 cursor-pointer hover:shadow-md transition">
                <p class="text-xs font-bold text-on-surface-muted uppercase tracking-wider">เสี่ยงสูง / ปานกลาง</p>
                <p id="kpi-high-risk" class="text-3xl font-bold text-amber-600 mt-1">0</p>
            </div>
            <div id="card-flooded" class="bg-surface p-4 rounded-lg shadow-sm border-b-4 border-red-500 cursor-pointer hover:shadow-md transition">
                <p class="text-xs font-bold text-on-surface-muted uppercase tracking-wider">น้ำท่วมแล้ว (Yes)</p>
                <p id="kpi-flooded" class="text-3xl font-bold text-red-600 mt-1">0</p>
            </div>
        </div>
        
        <div class="grid grid-cols-3 gap-4 mb-8">
            <div id="card-true" class="bg-surface p-3 rounded-lg shadow-sm border border-slate-200 cursor-pointer hover:border-red-500 hover:bg-red-50 transition text-center">
                <span class="text-xs font-bold text-on-surface-muted">TRUE</span>
                <p id="kpi-true" class="text-xl font-bold text-red-600">0</p>
            </div>
            <div id="card-dtac" class="bg-surface p-3 rounded-lg shadow-sm border border-slate-200 cursor-pointer hover:border-sky-500 hover:bg-sky-50 transition text-center">
                <span class="text-xs font-bold text-on-surface-muted">DTAC</span>
                <p id="kpi-dtac" class="text-xl font-bold text-sky-500">0</p>
            </div>
            <div id="card-ais" class="bg-surface p-3 rounded-lg shadow-sm border border-slate-200 cursor-pointer hover:border-green-500 hover:bg-green-50 transition text-center">
                <span class="text-xs font-bold text-on-surface-muted">AIS</span>
                <p id="kpi-ais" class="text-xl font-bold text-green-600">0</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <div class="lg:col-span-2 bg-surface p-1 rounded-lg shadow-md border border-slate-200">
                <div id="map"></div>
            </div>
            
            <div class="bg-surface p-4 rounded-lg shadow-md border border-slate-200 flex flex-col">
                <h2 class="text-lg font-bold mb-4 text-on-surface">สถานะตามจังหวัด</h2>
                <div class="relative flex-grow min-h-[300px]">
                    <canvas id="provinceChart"></canvas>
                </div>
            </div>
        </div>

        <div class="bg-surface p-4 rounded-lg shadow-md border border-slate-200">
            <h2 class="text-lg font-bold mb-4 text-on-surface">รายชื่อสาขา</h2>
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-on-surface-muted">
                    <thead class="text-xs text-on-surface uppercase bg-slate-100">
                        <tr>
                            <th scope="col" class="px-4 py-3">ID</th>
                            <th scope="col" class="px-4 py-3">ชื่อร้าน</th>
                            <th scope="col" class="px-4 py-3">SIM</th>
                            <th scope="col" class="px-4 py-3">จังหวัด</th>
                            <th scope="col" class="px-4 py-3">ความเสี่ยง</th>
                            <th scope="col" class="px-4 py-3 text-center">สถานะ</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody"></tbody>
                </table>
            </div>
            <div class="flex justify-between items-center mt-4 pt-4 border-t border-slate-100">
                <span id="pageInfo" class="text-xs text-on-surface-muted"></span>
                <div class="inline-flex rounded-md shadow-sm">
                    <button id="prevPage" class="px-3 py-1 text-sm font-medium bg-white border border-slate-300 rounded-l-lg hover:bg-slate-50">ก่อนหน้า</button>
                    <button id="nextPage" class="px-3 py-1 text-sm font-medium bg-white border-t border-b border-r border-slate-300 rounded-r-lg hover:bg-slate-50">ถัดไป</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        // --- 1. DATA & CONFIGURATION ---
        const tsvData = `ID_Shop	Store_Name	SIM	Province	Address	Risk	Status
19222	ร้านเซเว่น สาขา ห้วยโอน	TRUE	สงขลา	เลขที่ - ร้าน 7-11 รหัสสาขา 19222 ห้วยโอน - กำแพงเพชร รัตภูมิ สงขลา 90180			ปานกลาง	No/Online
622	ร้านเซเว่น สาขา ศุภสารรังสรรค์	TRUE	สงขลา	เลขที่ - 176 CP ALL (รหัสร้าน_622) ศุภสารรังสรรค์ - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Yes
6457	ร้านเซเว่น สาขา เตชาโต	TRUE	สงขลา	เลขที่ 351 351/1 ถ.ธรรมนูญวิถี หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
6522	ร้านเซเว่น สาขา ปตท.คอหงส์	TRUE	สงขลา	เลขที่ 2/9 หมู่ 5 ถ.กาญจนวานิช คอหงส์ หาดใหญ่ สงขลา 90110			สูง	Yes
12185	ร้านเซเว่น สาขา ม.หาดใหญ่	TRUE	สงขลา	เลขที่ - 7-11 CP ALL (รหัสร้าน_12185) ม.หาดใหญ่ - คอหงส์ หาดใหญ่ สงขลา 90110			สูง	Yes
16406	ร้านเซเว่น สาขา จันทร์วิโรจน์	TRUE	สงขลา	เลขที่ - โฉนด รหัสสาขา 16406 สาขาจันทร์วิโรจน์ - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Yes
10089	ร้านเซเว่น สาขา ถนนปุณกัณฑ์	TRUE	สงขลา	เลขที่ - 41/6 หมู่ที่ 6 CP ALL (รหัสร้าน_10089) ถนนปุณณกัณฑ์ คอหงส์ หาดใหญ่ สงขลา 90110			สูง	No
15328	ร้านเซเว่น สาขา ถนนทุ่งรี	TRUE	สงขลา	เลขที่ - คอหงส์ หาดใหญ่ สงขลา 90110			สูง	No
13110	ร้านเซเว่น สาขา ถนนนิพัทธ์ภักดี	TRUE	สงขลา	เลขที่ - 7-11 CP ALL (รหัสร้าน_13110) ถนนนิพัทธ์ภักดี - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Yes
16894	ร้านเซเว่น สาขา ร้าน เบลลินี่ เบคแอนด์บรู ถนน ปุณณกัณฑ์	TRUE	สงขลา	เลขที่ - 99/40 รหัสสาขา 16894 7-11 เบลลินี่ เบคแอนด์บรู ปุณณกัณฑ์ คอหงส์ หาดใหญ่ สงขลา 90110			สูง	No
15827	ถนนทุ่งรี-โคกวัด	TRUE	สงขลา	เลขที่ - 47/4 รหัสสาขา 15827 ถนนทุ่งรี-โคกวัด 47/4 คอหงส์ หาดใหญ่ สงขลา 90110			สูง	No
9051	ร้านเซเว่น สาขา หน้าหอประชุมมอ.	TRUE	สงขลา	43/199 หมู่ที่ 6 คอหงส์ หาดใหญ่ สงขลา 90000			สูง	No
594	ร้านเซเว่น สาขา ทุ่งเสา	TRUE	สงขลา	เลขที่ - 88,90 CP ALL (รหัสร้าน_594) ทุ่งเสา คอหงส์ หาดใหญ่ สงขลา 90110			สูง	Yes
6094	ร้านเซเว่น สาขา ปตท.ท่าช้าง(บางกล่ำ)	TRUE	สงขลา	เลขที่ 189/18 หมู่ 5 ท่าช้าง บางกล่ำ สงขลา 90110			สูง	No
13392	ร้านเซเว่น สาขา บ้านหนองข้อง	AIS	สงขลา	เลขที่ - บ้านหนองข้อง กำแพงเพชร รัตภูมิ สงขลา 90180			สูง	No
13965	ร้านเซเว่น สาขา ปตท.สิริพัฒน์(ท่าช้าง)	AIS	สงขลา	ร้าน 7-11 รหัสสาขา 13965 สาขาปตท.สิริพัฒน์ ร้าน 7-11 ท่าช้าง บางกล่ำ สงขลา 90110			สูง	No
8547	ร้านเซเว่น สาขา ปุณกันฑ์3	TRUE	สงขลา	เลขที่ 99/40 หมู่ 3 คอหงส์ หาดใหญ่ สงขลา 90110			สูง	No
18052	ร้านเซเว่น สาขา ถนนสายเอเชีย 43	AIS	สงขลา	เลขที่ - รหัสสาขา 18052 7-11 ถนนสายเอเชีย 43 - ท่าช้าง บางกล่ำ สงขลา 90110			สูง	No
8255	ร้านเซเว่น สาขา ทุ่งเสา 2	TRUE	สงขลา	เลขที่ - 51,53,55 CP ALL (รหัสร้าน_8255) ทุ่งเสา2 - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Yes
871	ร้านเซเว่น สาขา เสน่หานุสรณ์	TRUE	สงขลา	เลขที่ - 26/2-7 CP ALL (รหัสร้าน_871) เสน่หานุสรณ์ - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Yes
587	ร้านเซเว่น สาขา ตลาดกิมหยง	TRUE	สงขลา	เลขที่ - 36/1-2 CP ALL (รหัสร้าน_587) ตลาดกิมหยง - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Yes
18505	ร้านเซเว่น สาขา สวนหย่อมศุภสารรังสรรค์	TRUE	สงขลา	เลขที่ - 7-11 รหัสสาขา 18505 สวนหย่อมศุภสารรังสรรค์ - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Yes
8983	ร้านเซเว่น สาขา ศุภสารรังสรรค์ 2	TRUE	สงขลา	เลขที่ - 163 CP ALL (รหัสร้าน_8983) ศุภสารรังสรรค์2 หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Yes
961	ร้านเซเว่น สาขา ราษฎร์อุทิศ	TRUE	สงขลา	เลขที่ - 104 CP ALL (รหัสร้าน_961) ราษฎร์อุทิศ ราษฎร์อุทิศ หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Yes
6737	ร้านเซเว่น สาขา นิพัทธ์อุทิศ 3	TRUE	สงขลา	เลขที่ - 118-120 CP ALL (รหัสร้าน_6737) นิพัทธ์อุทิศ นิพัทธ์อุทิศ3 หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Yes
3560	ร้านเซเว่น สาขา ละม้ายสงเคราะห์	TRUE	สงขลา	เลขที่ 21/10 ถ.หอยมุกต์ หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Yes
9566	ร้านเซเว่น สาขา สามแยกโตนงาช้าง	AIS	สงขลา	15/2 15/3 15/11 หมู่3 ทุ่งตำเสา หาดใหญ่ สงขลา 90110			สูง	No
591	ร้านเซเว่น สาขา หน้าร.พ.หาดใหญ่	TRUE	สงขลา	เลขที่ 188/19-20 ถ.รัถการ หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Yes
11985	ร้านเซเว่น สาขา บ้านสามบ่อ	TRUE	สงขลา	เลขที่ - 70 หมู่ที่ 3 บ้านสามบ่อ ระวะ ระโนด สงขลา 90140			ปานกลาง	No/Online
589	ร้านเซเว่น สาขา ซีกิมหยง	TRUE	สงขลา	เลขที่ 7 8 ถ.ฉัยยากุลอุทิศ หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
13391	ร้านเซเว่น สาขา ถนนเสน่หานุสรณ์	TRUE	สงขลา	เลขที่ - 59/4 CP ALL (รหัสร้าน_13391) ถนนเสน่หานุสรณ์ เสน่หานุสรณ์ หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
17192	ร้านเซเว่น สาขา PTTOR ราษฎร์อุทิศ (หาดใหญ่)	TRUE	สงขลา	เลขที่ - ร้าน 7-11 รหัสสาขา 17192 PTTOR ราษฎร์อุทิศ (หาดใหญ่) - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
13089	ร้านเซเว่น สาขา ปตท.ถนนหาดใหญ่-รัตภูมิ	TRUE	สงขลา	เลขที่ - 1199 หมู่ 4 CP ALL (รหัสร้าน_13089) ปตท.ถนนหาดใหญ่-รัตภูมิ (RS) เพชรเกษม ควนลัง หาดใหญ่ สงขลา 90110			สูง	No
15932	ร้านเซเว่น สาขา ตำบลควนลัง	TRUE	สงขลา	เลขที่ - รหัสสาขา 15932 7-11 ควนลัง เพชรเกษม ควนลัง หาดใหญ่ สงขลา 90110			สูง	No
16129	ร้านเซเว่น สาขา ถนนสามชัย ซ.1	TRUE	สงขลา	เลขที่ - SHOP ID:16129 สาขา ถนนสามชัย ซ.1 - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
22705	ร้านเซเว่น สาขา ตลาดควนลัง	TRUE	สงขลา	เลขที่ - 7-ELEVEN รหัสสาขา 22705 ตลาดควนลัง - ควนลัง หาดใหญ่ สงขลา 90110			สูง	No
13393	ร้านเซเว่น สาขา ถนนราษฎร์ยินดี ซอย 9	TRUE	สงขลา	เลขที่ - ถนนราษฎร์ยินดี ซอย9 ราษฎร์ยินดี ราษฎร์ยินดี 9 หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
14486	ร้านเซเว่น สาขา จุติอนุสรณ์(14486)	TRUE	สงขลา	เลขที่ 108 ถนนจุติอนุสรณ์ หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
14871	ร้านเซเว่น สาขา เพชรเกษม(เทศบาลหาดใหญ่)	TRUE	สงขลา	เลขที่ - 430/2-4 ถนนเพชรเกษม หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
10831	ร้านเซเว่น สาขา ประกายทอง	TRUE	สงขลา	เลขที่ - ร้าน 7-11 ประกายทอง ควนลัง หาดใหญ่ สงขลา 90110			สูง	Yes
4588	ร้านเซเว่น สาขา เพชรเกษมซอย19	TRUE	สงขลา	เลขที่ 488/4 ถ.เพชรเกษม หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
16630	ร้านเซเว่น สาขา บางแฟบพัฒนา	TRUE	สงขลา	เลขที่ - ร้าน 7-11 รหัสสาขา 16630 สาขาบางแฟบพัฒนา - ควนลัง หาดใหญ่ สงขลา 90110			สูง	No
8369	ร้านเซเว่น สาขา พรุฉิมพลี	TRUE	สงขลา	17/1 หมู่ที่ 1 ถ.บ้านหน้าควนลัง - บ้านพรุ ควนลัง หาดใหญ่ สงขลา 90110			สูง	Yes
16580	ร้านเซเว่น สาขา ถนนบ้านบางนา(บางแฟบ)	TRUE	สงขลา	เลขที่ - โฉนด รหัสสาขา 16580 สาขาบ้านบางนา(บางแฟบ) - ควนลัง หาดใหญ่ สงขลา 90110			สูง	No
14305	ร้านเซเว่น สาขา ถนนคลองเรียน2	TRUE	สงขลา	เลขที่ 37/2 ถนนคลองเรียน2 หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
22798	ร้านเซเว่น สาขา ถนนราษฎร์ยินดี 30 เมตร หาดใหญ่	TRUE	สงขลา	เลขที่ - 7-11 รหัสสาขา 22798 ถ.ราษฎร์ยินดี 30 เมตร หาดใหญ่ - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
16856	ร้านเซเว่น สาขา เทศาพัฒนา	TRUE	สงขลา	เลขที่ - รหัสสาขา 16856 7-11 เทศาพัฒนา - ควนลัง หาดใหญ่ สงขลา 90110			สูง	No
10176	ร้านเซเว่น สาขา ทุ่งเสา 2 ซอย 10	TRUE	สงขลา	เลขที่ - 53,55,57,59 CP ALL (รหัสร้าน_10176) ทุ่งเสา2ซอย10 - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
22866	ร้านเซเว่น สาขา ถนนปุณกัณฑ์(คอหงส์)	TRUE	สงขลา	เลขที่ - ร้าน 7-11 รหัสสาขา 22866 ถนนปุณกัณฑ์(คอหงส์) - คอหงส์ หาดใหญ่ สงขลา 90110			ปานกลาง	No/Online
6303	ร้านเซเว่น สาขา ถนนสามชัย	TRUE	สงขลา	เลขที่ - 248 CP ALL (รหัสร้าน_6303) ถนนสามชัย - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
943	ร้านเซเว่น สาขา ตลาดใหม่	TRUE	สงขลา	เลขที่ 43-45 ถ.ต้นรัตนากร หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
17047	ร้านเซเว่น สาขา รัตนอุทิศ ซ.18	AIS	สงขลา	เลขที่ - ร้าน 7-11 รหัสสาขา 17047 รัตนอุทิศ ซ.18 - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
11112	ร้านเซเว่น สาขา ถนนปุณกัณฑ์ซอย12	TRUE	สงขลา	เลขที่ - ถนนปุณกัณฑ์ซอย12 ปุณกันณฑ์ซ.12 คอหงส์ หาดใหญ่ สงขลา 90110			ปานกลาง	No/Online
748	ร้านเซเว่น สาขา โชคสมานกุล	TRUE	สงขลา	เลขที่ 62 ถ.โชคสมาน 1 หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
985	ร้านเซเว่น สาขา หรรษา	TRUE	สงขลา	เลขที่ - 319 CP ALL (รหัสร้าน_985) หรรษา - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
13015	ร้านเซเว่น สาขา ถนนทวีรัตน์	TRUE	สงขลา	เลขที่ - ถนนทวีรัตน์ ทวีรัตน์ คอหงส์ หาดใหญ่ สงขลา 90110			ปานกลาง	No/Online
7811	ร้านเซเว่น สาขา คลองหอยโข่ง	TRUE	สงขลา	เลขที่ 196 197 หมู่ 7 ทุ่งลาน คลองหอยโข่ง สงขลา 90230			สูง	No
8321	ร้านเซเว่น สาขา รัตนอุทิศซอย11	TRUE	สงขลา	เลขที่ 105 107 ถ.รัตนอุทิศ หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
16478	ร้านเซเว่น สาขา สนามกีฬาจิระนคร	TRUE	สงขลา	เลขที่ - โฉนด รหัสสาขา 16478 สนามกีฬาจิระนคร - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
13537	ร้านเซเว่น สาขา สี่แยกสนามบินนอก	TRUE	สงขลา	เลขที่ - 1560 CP ALL (รหัสร้าน_13537) สี่แยกสนามบินนอก - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
14226	ร้านเซเว่น สาขา คลองเปี๊ยะ	AIS	สงขลา	เลขที่ - จะโหนง จะนะ สงขลา 90130			ปานกลาง	No/Online
5963	ร้านเซเว่น สาขา นิพัทธ์สงเคราะห์2	TRUE	สงขลา	เลขที่ 264/1-2 ถ.นิพัทธ์สงเคราะห์ 2 หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
10234	ร้านเซเว่น สาขา เพชรเกษม ซอย 41	TRUE	สงขลา	เลขที่ - 1347/1 CP ALL (รหัสร้าน_10234) เพชรเกษมซอย41 - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
10689	ร้านเซเว่น สาขา ถนนรัถการ	TRUE	สงขลา	เลขที่ - 430/1 CP ALL (รหัสร้าน_10689) ถนนรัถการ - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
9877	ร้านเซเว่น สาขา ปตท.บ้านในเมือง(จะนะ)	TRUE	สงขลา	เลขที่ 23/1 หมู่ 5 คลองเปียะ จะนะ สงขลา 90130			สูง	No
7001	ร้านเซเว่น สาขา ซอยทวีวรรณ	TRUE	สงขลา	เลขที่ 147 149 ถ.กาญจนวณิชย์ หาดใหญ่ หาดใหญ่ สงขลา 90110			ปานกลาง	No/Online
12163	ร้านเซเว่น สาขา ตลาดยรรยงค์	TRUE	สงขลา	เลขที่ - 70 หมู่ที่ 3 สาขาตลาดยรรยงค์ ระโนด-สงขลา ระวะ ระโนด สงขลา 90140			สูง	Yes
10451	ร้านเซเว่น สาขา รัตนอุทิศ ซ.13	TRUE	สงขลา	เลขที่ - 129131133 CP ALL (รหัสร้าน_10451) รัตนอุทิศซ.13 - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Yes
11232	ร้านเซเว่น สาขา ซอยไปดีมาดี	TRUE	สงขลา	เลขที่ - 18 CP ALL (รหัสร้าน_11232) ซอยไปดีมาดี อนุสรณ์อาจารย์ทอง หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
15484	ร้านเซเว่น สาขา PTTORหาดใหญ่ใน(ขาออก)	TRUE	สงขลา	เลขที่ - 1121/1 ถนนเพชรเกษม หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
23067	ร้านเซเว่น สาขา นิพัทธ์สงเคราะห์ 1 ซอย 16	AIS	สงขลา	เลขที่ - โฉนด รหัสสาขา 23067 7-11นิพัทธ์สงเคราะห์ 1 ซอย 16 - คลองแห หาดใหญ่ สงขลา 90110			สูง	No
22918	ร้านเซเว่น สาขา ศรีภูวนารถตัดใหม่	TRUE	สงขลา	เลขที่ - 7-ELEVEN รหัสสาขา 22918 ศรีภูวนารถตัดใหม่ - ควนลัง หาดใหญ่ สงขลา 90110			สูง	No
2892	ร้านเซเว่น สาขา บขส.หาดใหญ่	TRUE	สงขลา	เลขที่ - 143 CP ALL (รหัสร้าน_2892) บขส.หาดใหญ่ - หาดใหญ่ หาดใหญ่ สงขลา 90110			ปานกลาง	No/Online
9828	ร้านเซเว่น สาขา ซ.20 รัตนอุทิศ	TRUE	สงขลา	เลขที่ - 744 CP ALL (รหัสร้าน_9828) ซ.20รัตนอุทิศ - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	No
10305	ร้านเซเว่น สาขา ศรีภูวนาถใน	TRUE	สงขลา	เลขที่ - 15 หมู่ 1 CP ALL (รหัสร้าน_10305) ศรีภูวนาถใน - ควนลัง หาดใหญ่ สงขลา 90110			สูง	No
13699	ร้านเซเว่น สาขา บ้านท่าเคียน	TRUE	สงขลา	โฉนด รหัสสาขา 13699 7-11 สาขา บ้านท่าเคียน - ควนลัง หาดใหญ่ สงขลา 90110			สูง	No
11680	ร้านเซเว่น สาขา ราษฎร์อุทิศเขต8	TRUE	สงขลา	เลขที่ - 548 ราษฎร์อุทิศ 8 ราษฎร์อุทิศ หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Yes
8566	ร้านเซเว่น สาขา พลพิชัย	TRUE	สงขลา	เลขที่ 117 119 121 123 ถ.พลพิชัย หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Yes
16479	ร้านเซเว่น สาขา ถนนสมบูรณ์ 2	TRUE	สงขลา	เลขที่ - 7-ELEVEN รหัสสาขา 16479 7-11 ถนนสมบูรณ์ 2 - ควนลัง หาดใหญ่ สงขลา 90110			สูง	No
4528	ร้านเซเว่น สาขา ปตท.คลองหวะ	TRUE	สงขลา	เลขที่ 25/2 หมู่ 1 ถ.เลี่ยงเมือง (สายเอเชีย) ควนลัง หาดใหญ่ สงขลา 90110			สูง	No
23142	ร้านเซเว่น สาขา บายพาสโคกเมา	AIS	สงขลา	เลขที่ - 7-11 รหัสสาขา 23142 บายพาสโคกเมา - ท่าช้าง บางกล่ำ สงขลา 90110			สูง	No
8398	ร้านเซเว่น สาขา ทุ่งลุง 3	TRUE	สงขลา	เลขที่ - 360/1 CP ALL (รหัสร้าน_8398) ทุ่งลุง3 - พะตง หาดใหญ่ สงขลา 90230			สูง	Yes
807	ร้านเซเว่น สาขา ทุ่งลุง	TRUE	สงขลา	เลขที่ - 119/1 หมู่ 1 CP ALL (รหัสร้าน_807) ทุ่งลุง(หาดใหญ่) - พะตง หาดใหญ่ สงขลา 90230			สูง	No
17553	ร้านเซเว่น สาขา ถนนท่าโพธิ์	TRUE	สงขลา	เลขที่ - 7-11 รหัสสาขา 17553 ถนนท่าโพธิ์ - พังลา สะเดา สงขลา 90170			สูง	No
13203	ร้านเซเว่น สาขา ปตท.นาทวี-คลองแงะ	TRUE	สงขลา	เลขที่ - 34/4 หมู่ที่ 4 ปตท.นาทวีคลองแงะ นาทวี นาทวี สงขลา 90160			สูง	Yes
11677	ร้านเซเว่น สาขา ถนนวิเชียรชม	TRUE	สงขลา	เลขที่ - 43-43/1-7 CP ALL (รหัสร้าน_11677) ถนนวิเชียรชม(RS) - บ่อยาง เมืองสงขลา สงขลา 90000			ปานกลาง	No/Online
18648	ร้านเซเว่น สาขา กาญจนวนิช (ทุ่งลุง)	TRUE	สงขลา	เลขที่ - ร้าน 7-11 รหัสสาขา 18648 กาญจนวนิช (ทุ่งลุง) - พะตง หาดใหญ่ สงขลา 90230			สูง	No
2120	ร้านเซเว่น สาขา ปตท.เทพา	TRUE	สงขลา	เลขที่ 184 หมู่ 2 เทพา เทพา สงขลา 90150			ปานกลาง	No/Online
5290	ร้านเซเว่น สาขา ตลาดคลองหอยโข่ง	AIS	สงขลา	เลขที่ 300 หมู่ 2 คลองหอยโข่ง คลองหอยโข่ง สงขลา 90230			สูง	No
14429	ร้านเซเว่น สาขา ค่ายรัตนพล(คลองหอยโข่ง)	TRUE	สงขลา	เลขที่ โฉนด คลองหอยโข่ง คลองหอยโข่ง สงขลา 90230			สูง	Mobile Site down
9390	ร้านเซเว่น สาขา อำเภอเทพา	TRUE	สงขลา	30 ถ.เกษตรขันธ์ เทพา เทพา สงขลา 90150			สูง	Yes
10279	ร้านเซเว่น สาขา ปตท.สะกอม2	AIS	สงขลา	เลขที่ 47/1 หมู่ 2 สะกอม เทพา สงขลา 90150			สูง	No
7164	ร้านเซเว่น สาขา ปตท.นาทวีออยล์	TRUE	สงขลา	เลขที่ - 81/1 หมู่ที่ 5 ปตท.นาทวีออยส์ ฉาง นาทวี สงขลา 90160			สูง	No
17714	ร้านเซเว่น สาขา ตำบลสะพานไม้แก่น	TRUE	สงขลา	เลขที่ - 7-ELEVENรหัสสาขา 17714 ตำบลสะพานไม้แก่น - สะพานไม้แก่น จะนะ สงขลา 90130			สูง	Mobile Site down
8705	ร้านเซเว่น สาขา นาทวี2	TRUE	สงขลา	59/6 หมู่ 1 ถนนเพชรเกษม นาทวี นาทวี สงขลา 90160			สูง	Yes
11924	ร้านเซเว่น สาขา ปตท.นาทวีปิโตรเลี่ยม (Compact)	TRUE	สงขลา	เลขที่ - 90 หมู่ที่ 8 ปตท.นาทวีปิโตรเลียม นาทวี นาทวี สงขลา 90160			สูง	No
14111	ร้านเซเว่น สาขา นาทวี-ด่านประกอบ	AIS	สงขลา	เลขที่ ( ยังไม่มีเลขที่บ้าน ) นาทวี นาทวี สงขลา 90160			สูง	No
13671	ร้านเซเว่น สาขา พิชัยสงคราม (สะเดา)	AIS	สงขลา	เลขที่ - 39/4 พิชัยสงคราม สะเดา สะเดา สงขลา 90120			สูง	No
13702	ร้านเซเว่น สาขา ปตท.ถนนกองบิน56-คลองหอยโข่ง	AIS	สงขลา	เลขที่ - 27/2 หมู่ที่ 8 ปตท.ถนนกองบิน 56 คลองหอยโข่ง โคกม่วง คลองหอยโข่ง สงขลา 90110			สูง	Mobile Site down
9394	ร้านเซเว่น สาขา บ้านสะท้อน	AIS	สงขลา	เลขที่ 1/7 1/8 หมู่1 สะท้อน นาทวี สงขลา 90160			สูง	No
17709	ร้านเซเว่น สาขา ตำบลทุ่งหมอ	TRUE	สงขลา	เลขที่ - 7-11 รหัสสาขา 17709 ตำบลทุ่งหมอ - ทุ่งหมอ สะเดา สงขลา 90240			สูง	No
11735	ร้านเซเว่น สาขา ถนนบ้านพรุธานี	TRUE	สงขลา	เลขที่ - 53/5-7 CP ALL (รหัสร้าน_11735) ถนนบ้านพรุธานี - บ้านพรุ หาดใหญ่ สงขลา 90250			สูง	No
19873	ร้านเซเว่น สาขา ถนนทุ่งทอง(หาดใหญ่)	TRUE	สงขลา	เลขที่ - โฉนด รหัสสาขา 19873 ถนนทุ่งทอง(หาดใหญ่) - คลองแห หาดใหญ่ สงขลา 90110			สูง	Mobile Site down
19977	ร้านเซเว่น สาขา ถนนสาครมงคล	TRUE	สงขลา	เลขที่ - รหัสสาขา 19977 7-11 ถนนสาครมงคล - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Mobile Site down
18832	ร้านเซเว่น สาขา ถนนคึกฤทธิ์	TRUE	สงขลา	เลขที่ - 7-ELEVEN รหัสสาขา 18832 ถนนคึกฤทธิ์ - คลองแห หาดใหญ่ สงขลา 90110			สูง	Yes
18896	ร้านเซเว่น สาขา นิพัทธ์สงเคราะห์ 5 (หาดใหญ่)	TRUE	สงขลา	เลขที่ - ร้าน 7-11 รหัสสาขา 18896 นิพัทธ์สงเคราะห์ 5 (หาดใหญ่) - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Yes
17382	ร้านเซเว่น สาขา หมู่บ้านนครินทร์ธานี	TRUE	สงขลา	เลขที่ - 7-ELEVEN รหัสสาขา 17382 หมู่บ้านนครินทร์ธานี - ควนลัง หาดใหญ่ สงขลา 90110			สูง	Mobile Site down
11451	ร้านเซเว่น สาขา ถนนทุ่งใหญ่ (หาดใหญ่)	TRUE	สงขลา	เลขที่ - ถนนทุ่งใหญ่ ทุ่งใหญ่ คลองแห หาดใหญ่ สงขลา 90110			สูง	No
15182	ร้านเซเว่น สาขา ตำบลคูเต่า	AIS	สงขลา	เลขที่ - คูเต่า หาดใหญ่ สงขลา 90110			สูง	Mobile Site down
1097	ร้านเซเว่น สาขา นิพัทธ์สงเคราะห์1	TRUE	สงขลา	เลขที่ 41/185 ถ.นิพัทธ์สงเคราะห์ 1 หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Mobile Site down
9794	ร้านเซเว่น สาขา เพชรเกษม ซ.30	TRUE	สงขลา	เลขที่ - 1122/2 CP ALL (รหัสร้าน_9794) เพชรเกษมซ.30 - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Checking..
16275	ร้านเซเว่น สาขา ปากบาง(สะกอม)	TRUE	สงขลา	เลขที่ - โฉนด รหัสสาขา16275 สาขาปากบาง(สะกอม) - สะกอม เทพา สงขลา 90150			สูง	No
8544	ร้านเซเว่น สาขา ร.พ.กรุงเทพหาดใหญ่	TRUE	สงขลา	เลขที่ - 75 CP ALL (รหัสร้าน_8544) รพ.กรุงเทพ-หาดใหญ่ - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Checking..
15107	ร้านเซเว่น สาขา ตลาดปิ่นทองบ้านพรุ	TRUE	สงขลา	เลขที่ - โฉนด บ้านพรุ หาดใหญ่ สงขลา 90250			สูง	Checking..
14563	ร้านเซเว่น สาขา เพชรเกษมซอย45	TRUE	สงขลา	เลขที่ โฉนด หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Checking..
1213	ร้านเซเว่น สาขา ราษฏร์ยินดี	TRUE	สงขลา	เลขที่ 359 ถ.ศุภสารรังสรรค์ หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Checking..
8988	ร้านเซเว่น สาขา จะนะ2	TRUE	สงขลา	เลขที่ 8 หมู่ 2ถ.จะนะ - นาทวี บ้านนา จะนะ สงขลา 90130			สูง	No
2132	ร้านเซเว่น สาขา เทคนิคหาดใหญ่	TRUE	สงขลา	472 474 ถ.กาญจนวานิชย์ หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Checking..
2441	ร้านเซเว่น สาขา จะนะ	TRUE	สงขลา	เลขที่ - 76_78 หมู่ที่ 2 จะนะ-บ้านนา จะนะ สงขลา 90130			สูง	Checking..
3049	ร้านเซเว่น สาขา คลองเตยหาดใหญ่	TRUE	สงขลา	15/77 หมู่ 1 คอหงส์ หาดใหญ่ สงขลา 90110			สูง	Checking..
5436	ร้านเซเว่น สาขา ตลาดคลองแงะ	TRUE	สงขลา	เลขที่ - 41/1 หมู่ 5 CP ALL (รหัสร้าน_5436) ตลาดคลองแงะ คลองแงะ-นาทวี พังลา สะเดา สงขลา 90120			สูง	Checking..
5950	ร้านเซเว่น สาขา ซอยสุภาพอ่อนหวาน	TRUE	สงขลา	เลขที่ 564/3 ถ.กาญจนวณิชย์ หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Checking..
6133	ร้านเซเว่น สาขา อาเซี่ยนพลาซ่า	TRUE	สงขลา	เลขที่ 1468/1 1468/2 ถ.กาญจนวณิชย์ หาดใหญ่ หาดใหญ่ สงขลา 90110			ปานกลาง	Checking..
6335	ร้านเซเว่น สาขา หน้า ร.พ.ค่ายเสนาณรงค์	TRUE	สงขลา	เลขที่ - 730 CP ALL (รหัสร้าน_6335) หน้าร.พ.ค่ายเสนาณรงค์ - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Checking..
6368	ร้านเซเว่น สาขา ถนนสนามบินหาดใหญ่	TRUE	สงขลา	เลขที่ - 1728 หมู่ 3 CP ALL (รหัสร้าน_6368) ถนนสนามบินหาดใหญ่ - ควนลัง หาดใหญ่ สงขลา 90110			สูง	Checking..
7166	ร้านเซเว่น สาขา ปตท.คลองแห	TRUE	สงขลา	เลขที่ 89/13 หมู่ 11 คลองแห หาดใหญ่ สงขลา 90110			สูง	Checking..
8510	ร้านเซเว่น สาขา ควนเนียง	AIS	สงขลา	เลขที่ 103/11 รัตภูมิ ควนเนียง สงขลา 90220			สูง	Checking..
8689	ร้านเซเว่น สาขา ตลาดสดสะเดา	TRUE	สงขลา	เลขที่ 54 56 58 ถ.รวมใจ สะเดา สะเดา สงขลา 90120			สูง	Checking..
8874	ร้านเซเว่น สาขา ตลาดคลองเตย(หาดใหญ่)	TRUE	สงขลา	185/68-69 หมู่ที่ 1 คอหงส์ หาดใหญ่ สงขลา 90110			สูง	Checking..
9332	ร้านเซเว่น สาขา บ้านปริก	TRUE	สงขลา	เลขที่ - 95,97 CP ALL (รหัสร้าน_9332) บ้านปริก กาญจนวนิช3 ปริก สะเดา สงขลา 90120			สูง	Checking..
9393	ร้านเซเว่น สาขา คลองแห	AIS	สงขลา	58/8 หมู่ 4 คลองแห หาดใหญ่ สงขลา 90110			สูง	Checking..
9395	ร้านเซเว่น สาขา ลำไพล	AIS	สงขลา	เลขที่ 55/4 55/5 55/6 หมู่ 1 ลำไพล เทพา สงขลา 90150			สูง	Checking..
9578	ร้านเซเว่น สาขา นาสีทอง	AIS	สงขลา	เลขที่ 15/7 หมู่ 1 เขาพระ รัตภูมิ สงขลา 90180			สูง	Checking..
9749	ร้านเซเว่น สาขา ภาษีเจริญบ้านพรุ	TRUE	สงขลา	เลขที่ 43 ถ.สราญราษฏร์ บ้านพรุ หาดใหญ่ สงขลา 90110			สูง	Checking..
11045	ร้านเซเว่น สาขา พรุฉิมพลี ซอย 1	TRUE	สงขลา	เลขที่ - พรุฉิมพลี ซอย 1 ควนลัง หาดใหญ่ สงขลา 90110			สูง	Checking..
11288	ร้านเซเว่น สาขา ถนนอัมพวัน (หาดใหญ่)	TRUE	สงขลา	เลขที่ - 95/7 หมู่ที่ 3 ถนนอัมพวัน คลองแห หาดใหญ่ สงขลา 90110			สูง	Checking..
13215	ร้านเซเว่น สาขา ถนนนวลแก้วอุทิศ	TRUE	สงขลา	เลขที่ - 7-11 CP ALL (รหัสร้าน_13215) ถนนนวลแก้วอุทิศ - คอหงส์ หาดใหญ่ สงขลา 90110			สูง	Checking..
13304	ร้านเซเว่น สาขา เพชรเกษมซ.1	TRUE	สงขลา	เลขที่ - 912 CP ALL (รหัสร้าน_13304) เพชรเกษม ซ.1 เพชรเกษม หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Checking..
13449	ร้านเซเว่น สาขา ลพบุรีราเมศวร์(ขาออก)	TRUE	สงขลา	เลขที่ - 108/7 หมู่ที่ 3 ลพบุรีราเมศวร์ ขาออก คลองแห หาดใหญ่ สงขลา 90110			สูง	Checking..
13559	ร้านเซเว่น สาขา ปตท.จะนะ 2	TRUE	สงขลา	เลขที่ - 14/1 หมู่ที่ 1 ปตท.จะนะ2-หาดใหญ่ ปัตตานี บ้านนา จะนะ สงขลา 90130			สูง	Checking..
14084	ร้านเซเว่น สาขา ถนนสนามบิน(แอร์พอร์ท)	TRUE	สงขลา	เลขที่ - GREENFIELD ถนนสนามบิน(แอร์พอร์ต) ควนลัง หาดใหญ่ สงขลา 90110			สูง	Checking..
14112	ร้านเซเว่น สาขา คลองแห-คูเต่า	TRUE	สงขลา	เลขที่ 18/17 18/18 18/19 18/20 หมู่ที่ 5 คลองแห หาดใหญ่ สงขลา 90110			สูง	Checking..
14320	ร้านเซเว่น สาขา บ้านโคกเมา(บางกล่ำ)	TRUE	สงขลา	เลขที่ - ถนนท่าช้าง บางกล่ำ สงขลา 90110			สูง	Checking..
14404	ร้านเซเว่น สาขา ท่าอากาศย่านหาดใหญ่	TRUE	สงขลา	เลขที่ 99 หมู่ 3 ถนน สนามบินพาณิชย์ คลองหลา คลองหอยโข่ง สงขลา 90115			สูง	Checking..
14709	ร้านเซเว่น สาขา เพชรเกษมซ.10	TRUE	สงชลา	เลขที่ โฉนดที่ดินเลขที่ 7423 หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Checking..
14750	ร้านเซเว่น สาขา ตำบลน้ำน้อย	TRUE	สงขลา	เลขที่ 114 หมู่ 1 น้ำน้อย หาดใหญ่ สงขลา 90110			สูง	Checking..
15045	ร้านเซเว่น สาขา HatyaiElegance	TRUE	สงขลา	เลขที่ - โฉนด ควนลัง หาดใหญ่ สงขลา 90110			สูง	Checking..
15185	ร้านเซเว่น สาขา สะบ้าย้อย-คูหา	AIS	สงขลา	เลขที่ - คูหา สะบ้าย้อย สงขลา 90210			สูง	Checking..
15931	ร้านเซเว่น สาขา กาญจนวนิช(แยกคลองหวะ)	TRUE	สงขลา	เลขที่ - รหัสสาขา_15931 กาญจนวนิช(แยกคลองหวะ) - คอหงส์ หาดใหญ่ สงขลา 90110			สูง	Checking..
16164	ร้านเซเว่น สาขา ตำบลบ้านหาร(บางกล่ำ)	AIS	สงขลา	เลขที่ - ATM 7-11 รหัสสาขา 16164 สาขาบ้านหาร(บางกล่ำ) - บ้านหาร บางกล่ำ สงขลา 90110			สูง	Checking..
16187	ร้านเซเว่น สาขา ตลาดมากินตะ	AIS	สงขลา	เลขที่ - ร้าน 7-11 รหัสสาขา 16187 สาขาตลาดมากินตะ - - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Checking..
16198	ร้านเซเว่น สาขา ตำบลบ้านนา(จะนะ)	TRUE	สงขลา	เลขที่ - 7/6-8 หมู่ 1 รหัสสาขา 16198 บ้านนา(จะนะ) หาดใหญ่ -ปัตตานี บ้านนา จะนะ สงขลา 90130			สูง	Checking..
16287	ร้านเซเว่น สาขา ถนนนครใน	TRUE	สงขลา	เลขที่ - โฉนด รหัสสาขา16287 สาขาถนนนครใน - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Checking..
16566	ร้านเซเว่น สาขา วังใหญ่(เทพา)	TRUE	สงขลา	เลขที่ - 7-ELEVEN รหัสสาขา16566 7-11 วังใหญ่(เทพา) - วังใหญ่ เทพา สงขลา 90260			สูง	Checking..
16647	ร้านเซเว่น สาขา ตำบลเกาะสะบ้า	AIS	สงขลา	เลขที่ - รหัสสาขา 16647 7-11 ตำบลเกาะสะบ้า - เกาะสะบ้า เทพา สงขลา 90150			สูง	Checking..
16648	ร้านเซเว่น สาขา บางกล่ำ	AIS	สงขลา	เลขที่ - ร้าน 7-11 รหัสสาขา 16648 สาขาบางกล่ำ - - บางกล่ำ บางกล่ำ สงขลา 90110			สูง	Checking..
16699	ร้านเซเว่น สาขา PTTOR หาดใหญ่ (ช่องเขา)	TRUE	สงขลา	เลขที่ - 486 รหัสสาขา 16699 PTTOR หาดใหญ่(ช่องเขา) ศุภสารรังสรรค์ หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Checking..
16703	ร้านเซเว่น สาขา ตำบลทุ่งใหญ่	TRUE	สงขลา	เลขที่ - โฉนด ซีพีออลล์ รหัส_16703 ตำบลทุ่งใหญ่ - น้ำน้อย หาดใหญ่ สงขลา 90110			สูง	Checking..
16776	ร้านเซเว่น สาขา PTTOR สนามบินหาดใหญ่	TRUE	สงขลา	เลขที่ - 965 หมู่ 1 รหัสสาขา 16776 PTTOR สนามบินหาดใหญ่ สนามบิน-ลพบุรีราเมศวนร์ ควนลัง หาดใหญ่ สงขลา 90110			สูง	Checking..
17046	ร้านเซเว่น สาขา ตำบลทับช้าง	TRUE	สงขลา	เลขที่ - ร้าน 7-11 รหัสสาขา 17046 ตำบลทับช้าง - ทับช้าง นาทวี สงขลา 90160			สูง	Checking..
17208	ร้านเซเว่น สาขา PTTOR สะบ้าย้อย	AIS	สงขลา	เลขที่ - 44204 รหัสสาขา 17208 PTTOR สะบ้าย้อย ลำไพร-สะบ้าย้อย 1 สะบ้าย้อย สะบ้าย้อย สงขลา 90210			สูง	Checking..
17360	ร้านเซเว่น สาขา ม.ราชภัฏสงขลา	TRUE	สงขลา	เลขที่ - 7-ELEVEN รหัสสาขา 17360 ม.ราชภัฏสงขลา - เขารูปช้าง เมืองสงขลา สงขลา 90000			สูง	Checking..
17406	ร้านเซเว่น สาขา ถนนบางนา(บางกล่ำ)	TRUE	สงขลา	เลขที่ - 7-ELEVEN รหัสสาขา 17406 ถนนบางนา(บางกล่ำ) - ท่าช้าง บางกล่ำ สงขลา 90110			สูง	Checking..
17612	ร้านเซเว่น สาขา ถนนกาญจนราเมศวร์	TRUE	สงขลา	เลขที่ - 7-11 รหัสสาขา 17612 ถนนกาญจนราเมศวร์ - คลองแห หาดใหญ่ สงขลา 90110			สูง	Checking..
17955	ร้านเซเว่น สาขา ตำบลคลองแห	TRUE	สงขลา	เลขที่ - 7-11 รหัสสาขา 17955 ตำบลคลองแห - คลองแห หาดใหญ่ สงขลา 90110			สูง	Checking..
17975	ร้านเซเว่น สาขา ตำบลเขาพระ	TRUE	สงขลา	เลขที่ - ร้าน 7-11 รหัสสาขา 17975 ตำบลเขาพระ - เขาพระ รัตภูมิ สงขลา 90180			สูง	Checking..
18332	ร้านเซเว่น สาขา ตลาดน้ำคลองแห	TRUE	สงขลา	เลขที่ - โฉนด รหัสสาขา 18332 ตลาดน้ำคลองแห - คลองแห หาดใหญ่ สงขลา 90110			สูง	Checking..
18468	ร้านเซเว่น สาขา PTTOR บ้านตรับ	TRUE	สงขลา	เลขที่ - 196 หมู่ 11 รหัสสาขา 18468 PTTOR บ้านตรับ - จะโหนง จะนะ สงขลา 90130			สูง	Checking..
18506	ร้านเซเว่น สาขา PTTOR หน้าสวนสาธารณะ (หาดใหญ่)	TRUE	สงขลา	เลขที่ - 270/2 รหัสสาขา 18506 7-11 PTTOR หน้าสวนสาธารณะ - หาดใหญ่ หาดใหญ่ สงขลา 90110			สูง	Checking..
18651	ร้านเซเว่น สาขา ถนนภาสว่าง	TRUE	สงขลา	เลขที่ - โฉนด รหัสสาขา 18651 ถนนภาสว่าง - คอหงส์ หาดใหญ่ สงขลา 90110			สูง	Checking..
18652	ร้านเซเว่น สาขา ปักธง(หาดใหญ่)	TRUE	สงขลา	เลขที่ - โฉนด รหัสสาขา 18652 7-11 ปักธง(หาดใหญ่) - คอหงส์ หาดใหญ่ สงขลา 90110			สูง	Checking..
18691	ร้านเซเว่น สาขา คลองยา(บ้านพรุ)	TRUE	สงขลา	เลขที่ - โฉนด รหัสสาขา 18691 คลองยา(บ้านพรุ) - บ้านพรุ หาดใหญ่ สงขลา 90250			สูง	Checking..
18953	ร้านเซเว่น สาขา ถนนลำไพล-โคกโพธิ์	AIS	สงขลา	เลขที่ - ร้าน 7-11 รหัสสาขา 18953 ถนนลำไพล-โคกโพธิ์ - ท่าม่วง เทพา สงขลา 90150			สูง	Checking..
19453	ร้านเซเว่น สาขา หน้าสนามบินหาดใหญ่	TRUE	สงขลา	เลขที่ - โฉนด รหัสสาขา 19453 7-11 หน้าสนามบินหาดใหญ่ - คลองหลา คลองหอยโข่ง สงขลา 90110			สูง	Checking..
19956	ร้านเซเว่น สาขา ตำบลพะตง	TRUE	สงขลา	เลขที่ - 7-ELEVEN รหัสสาขา 19956 ตำบลพะตง - พะตง หาดใหญ่ สงขลา 90230			สูง	Checking..
22422	ร้านเซเว่น สาขา ถนนสงขลา-นวมินทร์(ขาเข้า)	AIS	สงขลา	เลขที่ - 7-ELEVEN รหัสสาขา 22422 ถนนสงขลา-นวมินทร์(ขาเข้า) - เขารูปช้าง เมืองสงขลา สงขลา 90000			สูง	Checking..
22745	ร้านเซเว่น สาขา ถนนนวลแก้วอุทิศ 2	TRUE	สงขลา	เลขที่ - โฉนด รหัสสาขา 22745 7-11 ถนนนวลแก้วอุทิศ 2 - คอหงส์ หาดใหญ่ สงขลา 90110			สูง	Checking..
23209							สูง	Checking..
2413	ร้านเซเว่น สาขา ย่านตาขาว	TRUE	ตรัง	เลขที่ 32 หมู่ 1 ถ.ตรัง-ปะเหลียน ย่านตาขาว ย่านตาขาว ตรัง 92140			สูง	No
17813	ร้านเซเว่น สาขา PTTOR สายบุรี	TRUE	ปัตตานี	เลขที่ - 7-ELEVEN รหัสสาขา 17813 PTTOR สายบุรี - ตะลุบัน สายบุรี ปัตตานี 94110			สูง	Checking..
15922	ร้านเซเว่น สาขา บ้านโสร่ง	AIS	ปัตตานี	เลขที่ - 7-ELEVEN รหัสสาขา 15922 บ้านโสร่ง - เขาตูม ยะรัง ปัตตานี 94160			ปานกลาง	Checking..
4384	ร้านเซเว่น สาขา ถนนนาเกลือ 2	TRUE	ปัตตานี	เลขที่ - 122/22 หมู่ที่ 8 ถนนนาเกลือ บานา เมืองปัตตานี ปัตตานี 94000			ปานกลาง	Checking..
4007	ร้านเซเว่น สาขา ปตท.ส.กมลวัฒนา	TRUE	ปัตตานี	เลขที่ - 162/42 หมู่ที่ 11 ปตท.ส.กลมวัฒนา บานา เมืองปัตตานี ปัตตานี 94000			ปานกลาง	Checking..
6810	ร้านเซเว่น สาขา ปตท.ปาลัส	TRUE	ปัตตานี	เลขที่ - 7/5 หมู่ที่ ที่1 CP ALL (รหัสร้าน_6810) ปตท.ปะนาเระ 6810 - ควน ปะนาเระ ปัตตานี 94130			ปานกลาง	Checking..
19398	ร้านเซเว่น สาขา บางปู	TRUE	ปัตตานี	เลขที่ - 9 ม.3 รหัสสาขา 19398 บางปู - บางปู ยะหริ่ง ปัตตานี 94150			สูง	Checking..
13820	ร้านเซเว่น สาขา วิฑูรอุทิศ 4	TRUE	ยะลา	เลขที่ - 70 ,72 CP ALL (รหัสร้าน_13820) สาขาวิฑูรอุทิศ 4 วิฑูรอุทิศ 4 สะเตง เมืองยะลา ยะลา 95000			สูง	No
15692	ร้านเซเว่น สาขา บ้านสถิตย์ภิรมย์	TRUE	ยะลา	เลขที่ - 99/115,99/116,99/117, 99/118 หมู่ที่ 1 เมืองยะลา ยะลา 95000			สูง	No
19044	ร้านเซเว่น สาขา ซอยโรงสี	TRUE	ยะลา	เลขที่ - 243/39 ม.12 รหัสสาขา 19044 ซอยโรงสี - สะเตงนอก เมืองยะลา ยะลา 95000			สูง	Checking..
5554	ร้านเซเว่น สาขา ศรีปุตรา	TRUE	ยะลา	เลขที่ - 808 CP ALL (รหัสร้าน_5554) ศรีปุตรา รหัสสาขา5554 สิโรรส สะเตง เมืองยะลา ยะลา 95000			สูง	Checking..
16367	ร้านเซเว่น สาขา ตือเบาะ 2	TRUE	ยะลา	เลขที่ - 127/14 หมู่ 10 รหัส_16367 ตือเบาะ 2 - สะเตง เมืองยะลา ยะลา 95000			สูง	Checking..
13121	ร้านเซเว่น สาขา หน้าโคลีเซียม	TRUE	ยะลา	เลขที่ - หน้าโคลีเซียม สะเตง เมืองยะลา ยะลา 95000			สูง	No
15883	PTTOR ลำใหม่(ยะลา)	TRUE	ยะลา	เลขที่ - 85/11 รหัสสาขา 15883 PTTOR ลำใหม่(ยะลา) 85/11 ลำใหม่ เมืองยะลา ยะลา 95160			สูง	Checking..
4977	ร้านเซเว่น สาขา ธนวิถี	TRUE	ยะลา	เลขที่ - 8-10 ธนวิถี เทศบาล4 สะเตง เมืองยะลา ยะลา 95000			สูง	Checking..
5518	ร้านเซเว่น สาขา สินอุทิศ	TRUE	ยะลา	เลขที่ - 43/1 สินอุทิศ เทศบาล1 สะเตง เมืองยะลา ยะลา 95000			สูง	No
6496	ร้านเซเว่น สาขา ปตท.ละงู	TRUE	สตูล	เลขที่ 222 หมู่ 9 ละงู ละงู สตูล 91110			สูง	No
1918	ร้านเซเว่น สาขา ละงู	TRUE	สตูล	เลขที่ 38-39 หมู่ที่ 4 กำแพง ละงู สตูล 91110			สูง	No
5101	ร้านเซเว่น สาขา หน้า ร.พ. นราธิวาส	TRUE	นราธิวาส	เลขที่ - 285 หน้า ร.พ. นราธิวาส ระแงะมรรคา บางนาค เมืองนราธิวาส นราธิวาส 96000			ปานกลาง	Checking..
5559	ร้านเซเว่น สาขา FR.ศรีสาคร	AIS	นราธิวาส	เลขที่ 41 หมู่ 1 ศรีสาคร ศรีสาคร นราธิวาส 96210			สูง	Checking..
18162	ร้านเซเว่น สาขา หน้าโรงพยาบาลจะแนะ	AIS	นราธิวาส	เลขที่ - โฉนด รหัสสาขา 18162 หน้าโรงพยาบาลจะแนะ - จะแนะ จะแนะ นราธิวาส 96220			สูง	Checking..
19470	ร้านเซเว่น สาขา PTTOR จะแนะ	TRUE	นราธิวาส	เลขที่ - 7-ELEVEN รหัสสาขา 19470 PTTOR จะแนะ - ดุซงญอ จะแนะ นราธิวาส 96220			ปานกลาง	Checking..
16584	ร้านเซเว่น สาขา กะพ้อ	AIS	ปัตตานี	เลขที่ - 124/7-124/9 รหัสสาขา 16584 7-11 กะพ้อ - กะรุบี กะพ้อ ปัตตานี 94230			ปานกลาง	Checking..
18031	ร้านเซเว่น สาขา ปะนาเระ	TRUE	ปัตตานี	เลขที่ - 267/1 หมู่ 4 รหัสสาขา 18031 สาขาปะนาเระ - ปะนาเระ ปะนาเระ ปัตตานี 94130			ปานกลาง	Checking..
7847	ร้านเซเว่น สาขา ปากพะยูน	TRUE	พัทลุง	752/2-3 หมู่ 1 ปากพะยูน ปากพะยูน พัทลุง 93120			สูง	Checking..
19979	ร้านเซเว่น สาขา บ้านพรุพ้อ	TRUE	พัทลุง	เลขที่ - โฉนด รหัสสาขา 19979 7-11 บ้านพรุพ้อ - โคกทราย ป่าบอน พัทลุง 93170			สูง	Checking..
5317	ร้านเซเว่น สาขา วัดเห้งเจีย	TRUE	ยะลา	เลขที่ - 245/37 หมู่ที่ 4 วัดเห้งเจีย สะเตงนอก เมืองยะลา ยะลา 95000			สูง	Checking..
6041	ร้านเซเว่น สาขา ลำใหม่	AIS	ยะลา	เลขที่ - 25 หมู่ที่ 1 ลำใหม่ เมืองยะลา ยะลา 95000			สูง	Checking..
8636	ร้านเซเว่น สาขา ตลาดเมืองใหม่	TRUE	ยะลา	เลขที่ - 291-293 ตลาดเมืองใหม่ เปรมจิตต์ สุรพันธ์ สะเตง เมืองยะลา ยะลา 95000			สูง	Checking..
9193	ร้านเซเว่น สาขา ปตท.ยะลา-หาดใหญ่กม.125	TRUE	ยะลา	เลขที่ 2/10 หมู่ 4 ท่าสาป เมืองยะลา ยะลา 95000			ปานกลาง	Checking..
13120	ร้านเซเว่น สาขา จารูพัฒนา 2	TRUE	ยะลา	เลขที่ - ที่ดินเปล่า CP ALL (รหัสร้าน_13120) สาขาจารูพัฒนา 2 รหัส 13120 - สะเตง เมืองยะลา ยะลา 95000			สูง	Checking..
16302	ร้านเซเว่น สาขา PTTOR พีทีดี ยะลา (ขาเข้า)	AIS	ยะลา	เลขที่ - 2/14 หมู่ 4 PTTOR พีทีดี ยะลา (ขาเข้า) รหัสสาขา 16302 - ท่าสาป เมืองยะลา ยะลา 95000			สูง	Checking..
16622	ร้านเซเว่น สาขา PTTOR มัรกัส(ยะลา)	TRUE	ยะลา	เลขที่ - 13/4 หมู่ที่ 3 รหัสสาขา 16622 PTTOR มัรกัส(ยะลา) - สะเตง เมืองยะลา ยะลา 95000			สูง	Checking..
16739	ร้านเซเว่น สาขา บ้านบันนังดามา	TRUE	ยะลา	เลขที่ - 319 หมู่ 1 7-11 รหัสสาขา 16739 บ้านบันนังดามา - กาบัง กาบัง ยะลา 95120			สูง	Checking..
17947	ร้านเซเว่น สาขา บ้านเนียง	AIS	ยะลา	เลขที่ - 96/5 หมู่ 4 7-11 รหัสสาขา 17947 สาขาบ้านเนียง - เปาะเส้ง เมืองยะลา ยะลา 95000			สูง	Checking..
18544	ร้านเซเว่น สาขา PTTOR กาบัง	TRUE	ยะลา	เลขที่ - 211/2 หมู่ 1 รหัสสาขา 18544 7-11 PTTOR กาบัง - กาบัง กาบัง ยะลา 95120			สูง	Checking..
19900	ร้านเซเว่น สาขา PTTOR สะเตงนอก (เมืองยะลา)	TRUE	ยะลา	เลขที่ - 243/34 หมู่ 12 รหัสสาขา 19900 PTTOR สะเตงนอก (เมืองยะลา) - สะเตงนอก เมืองยะลา ยะลา 95000			สูง	Checking..
2598	ร้านเซเว่น สาขา สตูล2	TRUE	สตูล	เลขที่ 71/2 ถ.ศุลกานุกูล พิมาน เมืองสตูล สตูล 91000			สูง	Checking..
4763	ร้านเซเว่น สาขา โรงพยาบาลสตูล	AIS	สตูล	เลขที่ 20 ถ.หัตถกรรมศึกษา พิมาน เมืองสตูล สตูล 91000			สูง	Checking..
4967	ร้านเซเว่น สาขา ปตท.บ้านควน	TRUE	สตูล	เลขที่ - 413 หมู่ 5 CP ALL (รหัสร้าน_4967) ปตท.บ้านควน 4967 - บ้านควน เมืองสตูล สตูล 91000			สูง	Checking..
8559	ร้านเซเว่น สาขา ทุ่งหว้า	TRUE	สตูล	เลขที่ 196 198 หมู่ที่ 2 ทุ่งหว้า ทุ่งหว้า สตูล 91120			ปานกลาง	Checking..
8631	ร้านเซเว่น สาขา คลองขุด	AIS	สตูล	508 หมู่ที่ 7 คลองขุด เมืองสตูล สตูล 91000			ปานกลาง	Checking..
9103	ร้านเซเว่น สาขา หัตถกรรมศึกษา	AIS	สตูล	57 59 61 63 ถ.หัตถกรรมศึกษา พิมาน เมืองสตูล สตูล 91000			สูง	Checking..
11072	ร้านเซเว่น สาขา บ้านท่าจีน (สตูล)	TRUE	สตูล	เลขที่ - 708-708/1 หมู่ 6 CP ALL (รหัสร้าน_11072) บ้านท่าจีน(สตูล) - คลองขุด เมืองสตูล สตูล 91000			ปานกลาง	Checking..
13061	ร้านเซเว่น สาขา สตูลธานีซอย7	TRUE	สตูล	เลขที่ - สตูลธานีซอย7 พิมาน เมืองสตูล สตูล 91000			สูง	Checking..
14459	ร้านเซเว่น สาขา ถนนปานชูรำลึก	TRUE	สตูล	เลขที่ - โฉนดที่560 CP ALL (รหัสร้าน_14459) สาขาถนนปานชูรำลึก - ปานชูรำลึก พิมาน เมืองสตูล สตูล 91000			สูง	Checking..
15845	ร้านเซเว่น สาขา แยกฉลุง	TRUE	สตูล	เลขที่ - ร้าน 7-11 สาขา แยกฉลุง 7-11 รหัสสาขา 15845 ร้าน 7-11 ฉลุง เมืองสตูล สตูล 91140			สูง	Checking..
16447	ร้านเซเว่น สาขา บ้านในใส	TRUE	สตูล	เลขที่ - 186 หมู่ 15 7-11 รหัสสาขา 16447 บ้านในใส - ละงู ละงู สตูล 91110			สูง	Checking..
18293	ร้านเซเว่น สาขา บ้านปากบารา	TRUE	สตูล	เลขที่ - 7-ELEVEN รหัสสาขา 18293 บ้านปากบารา - ปากน้ำ ละงู สตูล 91110			ปานกลาง	Checking..
19035	ร้านเซเว่น สาขา ศุลกานุกูล ซอย 9	TRUE	สตูล	เลขที่ - โฉนด รหัสสาขา 19035 ศุลกานุกูล ซอย 9 - พิมาน เมืองสตูล สตูล 91000			สูง	Checking..
19250	ร้านเซเว่น สาขา ตำบลปากน้ำ	TRUE	สตูล	เลขที่ - 7-11 รหัสสาขา 19250 ตำบลปากน้ำ - ปากน้ำ ละงู สตูล 91110			ปานกลาง	Checking..
23271							ปานกลาง	Checking..
23346							สูง	Checking..`;

        const data = tsv_parser(tsvData);
        let filteredData = [...data];
        let currentPage = 1;
        const itemsPerPage = 10;
        let thailandGeoJsonData = null;

        // --- 2. MAP SETUP ---
        // เริ่มต้นที่ภาคใต้เพราะข้อมูลเน้นภาคใต้
        const map = L.map('map').setView([7.00, 100.50], 8);
        const initialZoom = 8;
        const initialCenter = [7.00, 100.50];
        let geojsonLayer;
        let markerLayer = L.layerGroup().addTo(map);

        // UPDATED: เพิ่มพิกัดจังหวัดภาคใต้ให้ครบ เพื่อให้หมุดขึ้นถูกต้อง
        const provinceCoords = {
            'กรุงเทพมหานคร': [13.75, 100.50],
            'สงขลา': [7.17, 100.61],
            'สตูล': [6.62, 100.06],
            'ปัตตานี': [6.86, 101.25],
            'ยะลา': [6.54, 101.28],
            'นราธิวาส': [6.42, 101.82],
            'พัทลุง': [7.61, 100.07],
            'ตรัง': [7.55, 99.60],
            'ภูเก็ต': [7.88, 98.39],
            'นครศรีธรรมราช': [8.43, 99.96],
            'กระบี่': [8.08, 98.90],
            'พังงา': [8.45, 98.52],
            'ระนอง': [9.95, 98.63],
            'สุราษฎร์ธานี': [9.13, 99.33],
            'ชุมพร': [10.49, 99.17]
        };

        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap contributors &copy; CARTO'
        }).addTo(map);

        // --- 3. CHART SETUP ---
        const chartCtx = document.getElementById('provinceChart').getContext('2d');
        let provinceChart;

        // --- 4. FETCH DATA ---
        fetch('https://raw.githubusercontent.com/apisit/thailand.json/master/thailand.json')
            .then(response => response.json())
            .then(geojson => {
                thailandGeoJsonData = geojson;
                renderAll();
            })
            .catch(error => console.error("Could not load Map Data:", error));

        // --- 5. RENDER FUNCTIONS ---
        function renderAll() {
            if (!thailandGeoJsonData) return;
            updateKPIs();
            updateMap();
            updateChart();
            updateTable();
        }

        function updateKPIs() {
            document.getElementById('kpi-total-stores').textContent = filteredData.length;
            document.getElementById('kpi-affected-provinces').textContent = new Set(filteredData.map(d => d.Province).filter(Boolean)).size;
            document.getElementById('kpi-high-risk').textContent = filteredData.filter(d => ['สูง', 'ปานกลาง'].includes(d.Risk)).length;
            document.getElementById('kpi-flooded').textContent = filteredData.filter(d => d.Status === 'Yes').length;

            const countSim = (provider) => filteredData.filter(d => d.SIM && d.SIM.trim().toLowerCase() === provider.toLowerCase()).length;
            document.getElementById('kpi-true').textContent = countSim('true');
            document.getElementById('kpi-dtac').textContent = countSim('dtac');
            document.getElementById('kpi-ais').textContent = countSim('ais');
        }

        function updateMap() {
            if (geojsonLayer) map.removeLayer(geojsonLayer);
            markerLayer.clearLayers();

            // คำนวณสีจังหวัด
            const provinceData = filteredData.reduce((acc, store) => {
                const p = store.Province;
                if (!p) return acc;
                if (!acc[p]) acc[p] = { total: 0, flooded: 0, high: 0 };
                acc[p].total++;
                if (store.Status === 'Yes') acc[p].flooded++;
                if (store.Risk === 'สูง') acc[p].high++;
                return acc;
            }, {});

            geojsonLayer = L.geoJSON(thailandGeoJsonData, {
                style: feature => ({
                    fillColor: getProvinceColor(provinceData[feature.properties.name]),
                    weight: 1, opacity: 1, color: '#fff', dashArray: '3', fillOpacity: 0.7
                }),
                onEachFeature: (feature, layer) => {
                    const pName = feature.properties.name;
                    const stats = provinceData[pName];
                    if (stats) {
                        layer.bindTooltip(`<b>${pName}</b><br>สาขา: ${stats.total}<br>เสี่ยงสูง: ${stats.high}<br>ท่วม: ${stats.flooded}`);
                    }
                }
            }).addTo(map);

            // สร้าง Custom Icon
            const createIcon = (color) => L.divIcon({
                html: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="${color}" width="32px" height="32px"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5S10.62 6.5 12 6.5s2.5 1.12 2.5 2.5S13.38 11.5 12 11.5z"/><circle cx="12" cy="9.5" r="1.5" fill="white"/></svg>`,
                iconSize: [32, 32], iconAnchor: [16, 32], popupAnchor: [0, -34]
            });

            const icons = {
                'ต่ำ': createIcon('#10b981'),
                'ปานกลาง': createIcon('#f59e0b'),
                'สูง': createIcon('#ef4444')
            };

            const bounds = L.latLngBounds(); // สำหรับ Auto Zoom

            filteredData.forEach(store => {
                const coords = provinceCoords[store.Province];
                if (coords) {
                    // กระจายจุดเล็กน้อยไม่ให้ทับกันเป๊ะๆ
                    const lat = coords[0] + (Math.random() - 0.5) * 0.08;
                    const lng = coords[1] + (Math.random() - 0.5) * 0.08;
                    
                    const marker = L.marker([lat, lng], { icon: icons[store.Risk] || icons['ต่ำ'] });
                    marker.bindPopup(`<b>${store.Store_Name}</b><br>${store.Province}<br>SIM: ${store.SIM}<br>Status: ${store.Status}`);
                    markerLayer.addLayer(marker);
                    bounds.extend([lat, lng]);
                }
            });

            // Auto Zoom ไปหาจุด
            if (filteredData.length > 0 && bounds.isValid()) {
                map.fitBounds(bounds, { padding: [50, 50], maxZoom: 10 });
            } else {
                map.setView(initialCenter, initialZoom);
            }
        }

        function getProvinceColor(stats) {
            if (!stats) return '#e2e8f0'; // สีเทาอ่อน (ไม่มีข้อมูล)
            if (stats.flooded > 0) return '#ef4444'; // แดง (มีท่วม)
            if (stats.high > 0) return '#f59e0b'; // ส้ม (เสี่ยงสูง)
            return '#3b82f6'; // น้ำเงิน (ปกติ)
        }

        function updateChart() {
            const counts = filteredData.reduce((acc, store) => {
                const p = store.Province;
                if (!p) return acc;
                if (!acc[p]) acc[p] = { yes: 0, no: 0 };
                store.Status === 'Yes' ? acc[p].yes++ : acc[p].no++;
                return acc;
            }, {});

            const labels = Object.keys(counts);
            const dataYes = labels.map(p => counts[p].yes);
            const dataNo = labels.map(p => counts[p].no);

            if (provinceChart) provinceChart.destroy();
            provinceChart = new Chart(chartCtx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'น้ำท่วม (Yes)', data: dataYes, backgroundColor: '#ef4444' },
                        { label: 'ปกติ (No)', data: dataNo, backgroundColor: '#3b82f6' }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { x: { stacked: true }, y: { stacked: true } }
                }
            });
        }

        function updateTable() {
            const tbody = document.getElementById('dataTableBody');
            tbody.innerHTML = '';
            
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageData = filteredData.slice(start, end);

            pageData.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = "border-b hover:bg-slate-50";
                tr.innerHTML = `
                    <td class="px-4 py-3">${row.ID_Shop}</td>
                    <td class="px-4 py-3 font-medium">${row.Store_Name}</td>
                    <td class="px-4 py-3">${row.SIM}</td>
                    <td class="px-4 py-3">${row.Province}</td>
                    <td class="px-4 py-3"><span class="px-2 py-1 rounded text-xs text-white ${row.Risk === 'สูง' ? 'bg-red-500' : row.Risk === 'ปานกลาง' ? 'bg-amber-500' : 'bg-teal-500'}">${row.Risk}</span></td>
                    <td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded text-xs ${row.Status === 'Yes' ? 'bg-red-100 text-red-800 font-bold' : 'bg-slate-100 text-slate-600'}">${row.Status}</span></td>
                `;
                tbody.appendChild(tr);
            });

            document.getElementById('pageInfo').textContent = `แสดง ${start+1}-${Math.min(end, filteredData.length)} จาก ${filteredData.length}`;
            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = end >= filteredData.length;
        }

        // --- UTILS ---
        function tsv_parser(text) {
            const lines = text.split('\n').filter(l => l.trim() !== ''); // ตัดบรรทัดว่างทิ้ง
            const headers = lines[0].split('\t').map(h => h.trim());
            return lines.slice(1).map(line => {
                const vals = line.split('\t');
                const obj = {};
                headers.forEach((h, i) => obj[h] = vals[i] ? vals[i].trim() : '');
                return obj;
            }).filter(item => item.ID_Shop && item.Province); // กรองเอาเฉพาะข้อมูลที่มี ID และจังหวัด
        }

        // --- EVENTS ---
        const resetFilter = () => {
            filteredData = [...data];
            document.getElementById('searchInput').value = '';
            currentPage = 1;
            renderAll();
        };

        document.getElementById('resetButton').addEventListener('click', resetFilter);
        
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            filteredData = data.filter(d => 
                Object.values(d).some(val => val.toString().toLowerCase().includes(term))
            );
            currentPage = 1;
            renderAll();
        });

        // Event Click on Cards
        const filterBy = (key, val) => {
            filteredData = data.filter(d => d[key] === val);
            currentPage = 1;
            renderAll();
        }

        document.getElementById('card-flooded').addEventListener('click', () => filterBy('Status', 'Yes'));
        document.getElementById('card-high-risk').addEventListener('click', () => {
             filteredData = data.filter(d => d.Risk === 'สูง');
             currentPage = 1;
             renderAll();
        });
        
        ['card-total', 'card-provinces'].forEach(id => document.getElementById(id).addEventListener('click', resetFilter));
        
        const filterSim = (sim) => {
            filteredData = data.filter(d => d.SIM && d.SIM.toLowerCase() === sim);
            currentPage = 1;
            renderAll();
        }
        document.getElementById('card-true').addEventListener('click', () => filterSim('true'));
        document.getElementById('card-dtac').addEventListener('click', () => filterSim('dtac'));
        document.getElementById('card-ais').addEventListener('click', () => filterSim('ais'));

        document.getElementById('prevPage').addEventListener('click', () => { if(currentPage > 1) { currentPage--; updateTable(); } });
        document.getElementById('nextPage').addEventListener('click', () => { if(currentPage * itemsPerPage < filteredData.length) { currentPage++; updateTable(); } });

        // Clock
        setInterval(() => {
            const now = new Date();
            document.getElementById('clock').innerHTML = now.toLocaleDateString('th-TH') + ' ' + now.toLocaleTimeString('th-TH');
        }, 1000);

    });
    </script>
</body>
</html>
